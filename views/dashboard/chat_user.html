{% extends '/../../views/base_dashboard.html' %}

{% block title %}
Discussion
{% endblock %}

{% block navtitle %}
Discussion
{% endblock %}

{% block body %}

<section>
  <div class="container">
    <div class="row text-center">
      <h2>Discussion - <span id="contact"></span></h2>
    </div>
    <div class="row text-center" id="messages-wait">
      <i class="fas fa-circle-notch fa-spin fa-2x"></i>
    </div>
    <div class="row text-center" id="nomessage" style="display: none">
      <h3>Vous n'avez pas encore de conversation !</h3>
    </div>
    <div class="row" id="messages">
    </div>

    <div class="row msgZone">
      <textarea id="text-message" placeholder="Message"></textarea>
      <button type="button" class="btn btn-primary" id="btn-send-message">
        Envoyer <i id="wait-send-message" class="fas fa-circle-notch fa-spin" style="display: none"></i>
      </button>
    </div>
  </div>
</section>

{% endblock %}

{% block scripts %}

<script type="text/javascript">
  $(function() {
    var url = new URL(window.location.href);
    var contact_id = url.searchParams.get('id');

    function getMessages() {
      getUserContactMessages(contact_id);

      setTimeout(getMessages, 10000);
    }

    getMessages();

    $('#btn-send-message').on('click', function() {
      sendMessageTo(contact_id, $('#text-message').val());
    });
  });
</script>

{% endblock %}
